# HTTP 权威指南

# 概述

客户端向服务器发起请求,服务器会去查找对应的对象,并且把`对象、对象的类型、大小`返回给客户端。

## 资源

资源类型:文本、html、word、pdf等等。

### 媒体类型

服务器会将资源类型 MIME 返回给客户端,客户端根据 MIME 来执行下一步操作。[常见类型](http://www.w3school.com.cn/media/media_mimeref.asp):

- text/html
- text/plain
- image/jpeg
- image/gif
- video/quicktime
- application/vnd.ms-powerpoint

## URI

每个资源都有一个名字:统一**资源标识符** URI。URI 有两种形式: URL、URN。

URL:统一**资源定位符**。例如: `http://www.baidu.com/root/index.html` 第一部分`http://`说明访问资源使用的协议,第二部分`/www.baidu.com`说明资源所在的服务器地址,第三部分`/root/index.html`说明的位置。

URN:统一**资源名**,根据名称来标识资源,目前处于实验阶段

## 事务

HTTP 事务有一条请求命令和一条响应结果组成

### 命令(HTTP请求方法)

常见方法:
- GET: 从服务器向客户端发送命名资源
- PUT: 将客户端数据存储到服务器中一个命名的资源中去
- DELETE: 从服务器删除命名资源
- POST: 将客户端数据发送到服务器网关应用
- HEAD: 仅发送命名资源响应中的HTTP首部

### 状态码

每条 HTTP 响应都会带有一个状态码,是三位数字,告知客户端是否成功,或者是否需要采取其他行动。常见码：
- 200: OK 文档正确返回
- 302: redirect 到其他地方去获取资源
- 404: not found 无法找到这个资源

伴随着状态码后面,还会跟着一个原因短语。例如：
- 200 OK
- 200 Success
- 200 All‘s cool，dude

## 报文

HTTP 报文有一行一行简单的字符串组成。报文都是纯文本，不是二进制代码。报文包括三部分：

**起始行**：在请求报文中说明要做什么，在响应报文中说明出现什么情况

**首部字段**：起始行后面有零个或多个首部字段，每个字段包含一个名字和一个值，名称后面跟随`:`然后是值。首部以一个空行结束`\n`,每一个首部字段最后都要添加`\n`

**主体**：空行之后就是可选的报文主题


```
GET / HTTP/1.1\n
Accept: text/*\n
\n
hello world
```

`Content-Length`表示响应主体的长度

## 连接基于 TCP/IP

## 协议版本

目前主要是HTTP/1.1 

HTTP-NG(HTTP/2.0)关注性能的大幅优化但是1998年就停止了研究

## Web 的结构组件

- 代理: 位于客户端和服务器之间的 HTTP 中间实体
- 缓存: HTTP 的仓库,使常用页面的副本可以保存在里客户端更近的地方
- 网关: 连接其他应用程序的特殊 Web 服务器
- 隧道: 对 HTTP 通信报文进行盲转发的特殊代理
- Agent 代理: 发起自动 HTTP 请求的半智能 Web 客户端

### 代理

出于安全考虑通常将代理作为转发所有 Web 流量的可信任中间节点使用。代理还可以对请求和响应进行过滤

### 缓存

Web 缓存（web cache）或者代理缓存（proxy cache）。是一种特殊的 HTTP 代理服务器。经过代理传送的常用文档复制保存起来，客户端从附近缓存下载文档会比从不远程 Web 服务器下载快的多。HTTP 定义了很多功能使得缓存更加高效

### 网关

网关是一种特殊的服务器，作为其他服务器的中间实体使用。通常用于将 HTTP 流量转换成其他的协议。

例如 HTTP/FTP 网关会通过 HTTP 请求接受对 FTP URI的请求,但通过 FTP 协议来获取文档.得到的文档会被封装成一条 HTTP 报文,发送给客户端.

`客户端<--HTTP--> HTTP/FTP <--FTP-->FTP 服务器`

### 隧道

没明白原理

### Agent 代理

代表用户发起请求的客户端程序,常见的时 Web 浏览器。还有一些例如：网络蜘蛛、Web 机器人

# URL 与资源

格式:`方案://服务器位置/路径` 方案通常是协议例如 http、ftp、rtsp 等。url 的格式也会随着使用的方案不同而不同，大部分 url 方案的语法如下：
`<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>`

- scheme: 访问服务器时使用的协议, 无默认值
- user: 使用特定 scheme 访问资源时需要的用户名 默认匿名
- password: 用户名后面可能包含密码,使用`:`分隔
- host: 资源宿主服务器的主机名或 ip 地址
- port: 每个 schem 都有端口号
- path: 服务器上资源的本地名,使用`/`与前面的 URL 组件分隔开
- params: 某些方案会用这个组件来制定输入参数,参数为`键值对`
- query: 某些方案会传递这个参数来激活应用功能程序,用`?`与前面分隔
- frag: 片段,一小片或一部分资源的名字,引用对象时,不会讲 frag 字段传递给服务器,他是在客户端内部使用的.通过`#`分隔。服务器只处理整个对象，而不是片段，客户端不能将片段传递给服务器。浏览器从服务器获得了整个资源之后，会根据片段来显示你感兴趣的那部分资源

## URL 快捷方式

URL 有两种方式：绝对的和相对的

相对 URL 只是 URL的片段或一小部分。处理 URL 的应用程序要能够在相对和绝对 URL 之间进行切换。

处理相对 URL 的第一步就是找到基础 URL。基础 URL 是作为相对 URL的参考点使用的。可以来自几个不同的地方：
- 在资源中显示的提供：HTML 中的 BASE 标签
- 封装资源的基础 URL： 使用该资源所属资源的 URL 作为基础

## URL 字符

URL 传输过程不可丢失信息，并且 URL 可能二进制数据, 那么需要转义,转义格式:一个`%`跟着两个表示字符的 ASCII 码的十六进制数

## 未来展望

URL 表示的是实际的地址,而不是准确的名字。当资源被移走了，URL 就失效了

URN 用于使得无论资源移动到何处，都可以通过 URN 来访问到

# HTTP 报文



















